<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Elite Terminal | Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª Ù¾ÛŒØ´Ø±ÙØªÙ‡</title>
    <style>
        :root {
            --bg: #0a0b10;
            --card: rgba(17, 21, 32, 0.95);
            --primary: #00d9ff;
            --accent: #f0b90b;
            --danger: #ff4d4d;
            --success: #00ffa3;
            --warning: #ffaa00;
            --neon-shadow: 0 0 15px rgba(0, 217, 255, 0.4);
            --glass-border: 1px solid rgba(255,255,255, 0.05);
        }

        body {
            background: var(--bg);
            background-image: radial-gradient(circle at top right, #1a1f2e, var(--bg));
            color: white;
            font-family: 'Segoe UI', Tahoma, sans-serif;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }

        .dashboard {
            display: grid;
            grid-template-columns: 320px 1fr;
            gap: 25px;
            max-width: 1500px;
            margin: 0 auto;
        }

        /* Ø§Ø³ØªØ§ÛŒÙ„ Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ Ø´ÛŒØ´Ù‡â€ŒØ§ÛŒ */
        .glass-card {
            background: var(--card);
            backdrop-filter: blur(10px);
            border: var(--glass-border);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            transition: all 0.3s ease;
        }

        .glass-card:hover {
            box-shadow: 0 15px 40px rgba(0, 217, 255, 0.1);
        }

        /* ØªØ¨â€ŒÙ‡Ø§ÛŒ Ø§Ø³Ú©Ù† Ú©Ø±ÛŒÙ¾ØªÙˆ */
        .crypto-scan-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid rgba(255,255,255,0.1);
            padding-bottom: 10px;
            flex-wrap: wrap;
        }

        .scan-tab {
            background: transparent;
            border: none;
            color: #666;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            font-size: 12px;
        }

        .scan-tab:hover {
            background: rgba(255,255,255,0.05);
            color: var(--primary);
        }

        .scan-tab.active {
            background: rgba(0, 217, 255, 0.1);
            color: var(--primary);
            border-bottom: 2px solid var(--primary);
        }

        /* Ú©Ø§Ø±Øª Ø§Ø³Ú©Ù† Ú©Ø±ÛŒÙ¾ØªÙˆ */
        .crypto-scan-card {
            margin-top: 20px;
            max-height: 600px;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: var(--primary) transparent;
        }

        .crypto-scan-card::-webkit-scrollbar {
            width: 8px;
        }

        .crypto-scan-card::-webkit-scrollbar-track {
            background: transparent;
        }

        .crypto-scan-card::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 4px;
        }

        .scan-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .scan-stats {
            display: flex;
            gap: 15px;
            font-size: 12px;
            flex-wrap: wrap;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .stat-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .stat-bullish { background: var(--success); }
        .stat-bearish { background: var(--danger); }
        .stat-neutral { background: var(--warning); }

        /* Ø¬Ø¯ÙˆÙ„ Ø§Ø³Ú©Ù† Ú©Ø±ÛŒÙ¾ØªÙˆ */
        .crypto-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 11px;
        }

        .crypto-table th {
            padding: 10px 6px;
            color: #666;
            font-weight: 600;
            text-align: center;
            background: rgba(255,255,255,0.03);
            border-bottom: 2px solid rgba(255,255,255,0.05);
            position: sticky;
            top: 0;
            backdrop-filter: blur(10px);
            z-index: 10;
        }

        .crypto-table td {
            padding: 8px 6px;
            text-align: center;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }

        .crypto-table tr:hover td {
            background: rgba(255,255,255,0.03);
        }

        .crypto-symbol {
            font-weight: bold;
            color: var(--primary);
            font-family: 'Courier New', monospace;
            cursor: pointer;
            text-decoration: underline;
        }

        .crypto-price {
            color: var(--success);
            font-weight: bold;
        }

        .crypto-change {
            font-weight: bold;
        }

        .change-positive { color: var(--success); }
        .change-negative { color: var(--danger); }

        .rsi-cell {
            position: relative;
            font-weight: bold;
        }

        .rsi-value {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            display: inline-block;
        }

        .rsi-oversold { 
            background: rgba(0, 255, 163, 0.15); 
            color: var(--success); 
        }

        .rsi-overbought { 
            background: rgba(255, 77, 77, 0.15); 
            color: var(--danger); 
        }

        .rsi-neutral { 
            background: rgba(0, 217, 255, 0.15); 
            color: var(--primary); 
        }

        /* Ù†Ø´Ø§Ù†Ú¯Ø± ÙˆØ§Ú¯Ø±Ø§ÛŒÛŒ */
        .divergence-indicator {
            display: inline-flex;
            align-items: center;
            gap: 3px;
            font-size: 10px;
        }

        .divergence-bullish {
            color: var(--success);
        }

        .divergence-bearish {
            color: var(--danger);
        }

        .divergence-none {
            color: #666;
        }

        /* Ù†Ø´Ø§Ù†Ú¯Ø± Ù…Ù†ÙÛŒ Ø¯Ø± Ù†Ø§Ø­ÛŒÙ‡ Ø§Ø´Ø¨Ø§Ø¹ */
        .oversold-negative {
            animation: blink 1s infinite;
            color: var(--danger) !important;
        }

        .oversold-negative::before {
            content: 'âˆ’';
            margin-left: 3px;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Ø¯Ú©Ù…Ù‡ Ø§Ø³Ú©Ù† Ú©Ø±ÛŒÙ¾ØªÙˆ */
        .btn-crypto-scan {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: #000;
            font-weight: bold;
            padding: 10px 20px;
            border-radius: 10px;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            font-size: 12px;
        }

        .btn-crypto-scan:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 217, 255, 0.3);
        }

        .btn-crypto-scan:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        /* Ø¨Ø§Ú©Ø³ Ø¬Ø³ØªØ¬Ùˆ */
        .search-container { 
            position: relative; 
            margin-bottom: 25px; 
        }
        
        #symbolSearch {
            width: 100%;
            background: rgba(0,0,0,0.3);
            border: 1px solid #333;
            padding: 15px 50px;
            border-radius: 12px;
            color: white;
            font-size: 16px;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        #symbolSearch::placeholder {
            color: #666;
        }

        #symbolSearch:focus { 
            border-color: var(--primary); 
            box-shadow: var(--neon-shadow); 
            outline: none; 
        }

        .search-icon {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--primary);
            font-size: 18px;
        }

        /* Ù†ØªØ§ÛŒØ¬ Ø¬Ø³ØªØ¬Ùˆ */
        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--card);
            backdrop-filter: blur(10px);
            border: var(--glass-border);
            border-radius: 12px;
            margin-top: 10px;
            max-height: 500px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .search-result-item {
            padding: 12px;
            cursor: pointer;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s ease;
            font-size: 14px;
        }

        .search-result-item:hover {
            background: rgba(255,255,255,0.05);
        }

        .search-result-item:last-child {
            border-bottom: none;
        }

        .result-symbol {
            font-weight: bold;
            color: var(--primary);
            font-family: 'Courier New', monospace;
        }

        .result-base {
            font-size: 11px;
            color: #666;
        }

        .result-price {
            font-size: 12px;
            color: var(--success);
            font-weight: bold;
        }

        /* Ú©Ù†ØªØ±Ù„â€ŒÙ‡Ø§ÛŒ ØªØ­Ù„ÛŒÙ„ */
        .analysis-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            align-items: center;
            flex-wrap: wrap;
        }

        .analysis-input {
            background: rgba(0,0,0,0.3);
            border: 1px solid #333;
            color: white;
            padding: 10px 15px;
            border-radius: 10px;
            font-size: 14px;
            min-width: 120px;
            flex: 1;
        }

        .analysis-select {
            background: rgba(0,0,0,0.3);
            border: 1px solid #333;
            color: white;
            padding: 10px 15px;
            border-radius: 10px;
            font-size: 14px;
            cursor: pointer;
            min-width: 100px;
        }

        /* Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ */
        .btn-group { 
            display: flex; 
            gap: 10px; 
            margin-bottom: 20px; 
            flex-wrap: wrap;
        }
        
        button {
            border-radius: 10px;
            border: none;
            padding: 10px 20px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            font-family: inherit;
            font-size: 13px;
            min-width: 100px;
            justify-content: center;
        }

        .btn-main { 
            background: var(--primary); 
            color: #000; 
            border: 2px solid transparent;
        }

        .btn-main:hover { 
            transform: translateY(-2px);
            box-shadow: var(--neon-shadow);
        }

        .btn-analyze {
            background: var(--success);
            color: #000;
            border: 2px solid transparent;
        }

        .btn-analyze:hover {
            background: #00e694;
            transform: translateY(-2px);
            box-shadow: 0 0 15px rgba(0, 255, 163, 0.4);
        }

        /* Ø§Ø¹Ù„Ø§Ù†â€ŒÙ‡Ø§ */
        .notification {
            position: fixed;
            top: 20px;
            left: 20px;
            padding: 15px 20px;
            background: var(--card);
            border: var(--glass-border);
            border-radius: 10px;
            color: white;
            z-index: 10000;
            display: none;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            backdrop-filter: blur(10px);
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { transform: translateX(-100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .notification-success {
            border-left: 4px solid var(--success);
        }

        .notification-error {
            border-left: 4px solid var(--danger);
        }

        .notification-info {
            border-left: 4px solid var(--primary);
        }

        /* Ù¾Ù†Ù„ AI */
        .ai-signal-card {
            background: rgba(0, 217, 255, 0.05);
            border: 1px solid rgba(0, 217, 255, 0.2);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 10px;
        }

        .ai-signal-buy {
            border-color: rgba(0, 255, 163, 0.3);
            background: rgba(0, 255, 163, 0.05);
        }

        .ai-signal-sell {
            border-color: rgba(255, 77, 77, 0.3);
            background: rgba(255, 77, 77, 0.05);
        }

        .ai-signal-hold {
            border-color: rgba(170, 170, 170, 0.3);
            background: rgba(170, 170, 170, 0.05);
        }

        .target-badge {
            display: inline-block;
            padding: 2px 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            font-size: 10px;
            margin-right: 5px;
        }

        .risk-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 10px;
            margin-right: 5px;
        }

        .risk-low {
            background: rgba(0, 255, 163, 0.2);
            color: var(--success);
        }

        .risk-medium {
            background: rgba(255, 170, 0, 0.2);
            color: var(--warning);
        }

        .risk-high {
            background: rgba(255, 77, 77, 0.2);
            color: var(--danger);
        }

        /* Ù¾Ø±ÙˆÚ¯Ø±Ø³ Ø¨Ø§Ø± */
        .progress-bar {
            width: 100%;
            height: 6px;
            background: rgba(255,255,255,0.1);
            border-radius: 3px;
            overflow: hidden;
            margin: 5px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        /* Ù¾Ø§Ø³Ø®â€ŒØ´ÙˆÙ†Ø¯ÛŒ */
        @media (max-width: 1200px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .glass-card {
                padding: 15px;
            }
            
            button {
                padding: 8px 12px;
                font-size: 12px;
                min-width: 80px;
            }
            
            .crypto-table {
                font-size: 10px;
            }
            
            .analysis-controls {
                flex-direction: column;
            }
            
            .analysis-input, .analysis-select {
                width: 100%;
            }
        }

        /* Ø§Ø³ØªØ§ÛŒÙ„ Ø¨Ø±Ø§ÛŒ Ø³ØªØ§Ø±Ù‡ Ú©Ø§Ù†Ø¯ÛŒØ¯Ø§ÛŒ AI */
        .ai-star {
            color: var(--accent);
            font-size: 14px;
            margin-left: 5px;
        }

        /* Ø¬Ø¯ÙˆÙ„ Ù†ØªØ§ÛŒØ¬ AI */
        .ai-results-card {
            margin-top: 20px;
            border: 1px solid rgba(0, 217, 255, 0.3);
            background: rgba(0, 217, 255, 0.05);
        }

        .ai-badge {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 9px;
            font-weight: bold;
            margin-right: 3px;
        }

        .ai-badge-selected {
            background: rgba(240, 185, 11, 0.2);
            color: var(--accent);
        }

        .ai-badge-analyzed {
            background: rgba(0, 255, 163, 0.2);
            color: var(--success);
        }

        /* Ø§Ø³ØªØ§ÛŒÙ„ Ø¨Ø±Ø§ÛŒ Û±Û° Ø§Ø±Ø² ÙÛŒÙˆÚ†Ø±Ø² */
        .top-futures-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            cursor: pointer;
            transition: background 0.2s;
        }
        .top-futures-item:hover {
            background: rgba(255,255,255,0.05);
        }
        .top-futures-rank {
            font-weight: bold;
            color: var(--accent);
            margin-left: 10px;
        }
    </style>
</head>
<body>

<div class="notification" id="notification"></div>

<div class="dashboard">
    <!-- Ø³Ø§ÛŒØ¯Ø¨Ø§Ø± Ù…Ø§Ù†ÛŒØªÙˆØ±ÛŒÙ†Ú¯ -->
    <div class="sidebar glass-card">
        <h3>ğŸ›¡ï¸ Ø¯ÛŒØ¯Ù‡ Ø¨Ø§Ù† Ø§Ø¯Ù…ÛŒÙ†</h3>
        <div id="userList">
            <div class="user-card">
                <div class="user-info">
                    <div class="user-id">Ø³ÛŒØ³ØªÙ… ÙØ¹Ø§Ù„</div>
                </div>
                <div style="font-size: 11px; color: #666;">Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø±ÛŒÙ¾ØªÙˆ</div>
            </div>
        </div>
        
        <!-- Ù¾Ù†Ù„ ÙˆØ¶Ø¹ÛŒØª Ø§Ø³Ú©Ù† -->
        <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.1);">
            <h4 style="margin: 0 0 10px 0; color: var(--primary); font-size: 14px;">
                ğŸ“Š ÙˆØ¶Ø¹ÛŒØª Ø§Ø³Ú©Ù†
            </h4>
            <div id="scanStatus" style="font-size: 12px; color: #aaa;">
                Ø¢Ù…Ø§Ø¯Ù‡ Ø´Ø±ÙˆØ¹
            </div>
            <div class="progress-bar">
                <div id="scanProgress" class="progress-fill" style="width: 0%;"></div>
            </div>
            <div id="scanDetails" style="font-size: 11px; color: #666; margin-top: 5px;">
                Û° Ø§Ø² Û±ÛµÛ° Ø§Ø±Ø² Ø§Ø³Ú©Ù† Ø´Ø¯
            </div>
        </div>
    </div>

    <!-- Ù¾Ù†Ù„ Ø§ØµÙ„ÛŒ -->
    <div class="main-panel">
        <!-- Ø¨Ø§Ú©Ø³ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ -->
        <div class="glass-card" style="border-right: 5px solid var(--accent);">
            <h4 style="margin: 0 0 10px 0; color: var(--accent); display: flex; align-items: center; gap: 10px;">
                ğŸ’¡ Ø³ÛŒØ³ØªÙ… ØªØ­Ù„ÛŒÙ„ AI (Ø¯Ùˆ Ù…Ø±Ø­Ù„Ù‡â€ŒØ§ÛŒ)
            </h4>
            <div id="aiContent" class="ai-advice">
                <div style="padding: 15px; background: rgba(0,0,0,0.2); border-radius: 10px;">
                    <div style="color: var(--primary); font-weight: bold;">ğŸš€ Ø³ÛŒØ³ØªÙ… Ø¯Ùˆ Ù…Ø±Ø­Ù„Ù‡â€ŒØ§ÛŒ ÙØ¹Ø§Ù„</div>
                    <div style="color: #aaa; font-size: 13px; margin-top: 5px;">
                        <div>âœ… Ù…Ø±Ø­Ù„Ù‡ Û±: Ø§Ø³Ú©Ù† Ø¯Ø§Ø®Ù„ÛŒ Û±ÛµÛ° Ø§Ø±Ø² (RSI + ÙˆØ§Ú¯Ø±Ø§ÛŒÛŒ)</div>
                        <div>âœ… Ù…Ø±Ø­Ù„Ù‡ Û²: ØªØ­Ù„ÛŒÙ„ AI Ø¨Ø±Ø§ÛŒ Ûµ Ø§Ø±Ø² Ø¨Ø±ØªØ±</div>
                        <div style="margin-top: 10px; color: #666;">
                            ÙØ´Ø§Ø± Ø³Ø±ÙˆØ± Ø¨Ù‡ Ø­Ø¯Ø§Ù‚Ù„ Ø±Ø³ÛŒØ¯Ù‡
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ø¨Ø®Ø´ Ø§Ø³Ú©Ù† Ú©Ø±ÛŒÙ¾ØªÙˆ -->
        <div class="glass-card">
            <div class="scan-header">
                <h4 style="margin: 0; color: var(--primary); display: flex; align-items: center; gap: 10px;">
                    ğŸ” Ø³ÛŒØ³ØªÙ… Ø§Ø³Ú©Ù† Ø¯Ùˆ Ù…Ø±Ø­Ù„Ù‡â€ŒØ§ÛŒ
                </h4>
                
                <div class="scan-stats">
                    <div class="stat-item">
                        <span class="stat-dot stat-bullish"></span>
                        <span>ØµØ¹ÙˆØ¯ÛŒ: <span id="bullishCount">0</span></span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-dot stat-bearish"></span>
                        <span>Ù†Ø²ÙˆÙ„ÛŒ: <span id="bearishCount">0</span></span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-dot stat-neutral"></span>
                        <span>Ø®Ù†Ø«ÛŒ: <span id="neutralCount">0</span></span>
                    </div>
                    <div class="stat-item">
                        <span style="color: var(--accent);">â­ AI: <span id="aiCount">0</span>/5</span>
                    </div>
                </div>
            </div>

            <div class="crypto-scan-tabs">
                <button class="scan-tab active" onclick="filterCryptoScan('all')">Ù‡Ù…Ù‡ Ø§Ø±Ø²Ù‡Ø§</button>
                <button class="scan-tab" onclick="filterCryptoScan('bullish')">ØµØ¹ÙˆØ¯ÛŒ</button>
                <button class="scan-tab" onclick="filterCryptoScan('bearish')">Ù†Ø²ÙˆÙ„ÛŒ</button>
                <button class="scan-tab" onclick="filterCryptoScan('oversold')">Ø§Ø´Ø¨Ø§Ø¹ ÙØ±ÙˆØ´</button>
                <button class="scan-tab" onclick="filterCryptoScan('overbought')">Ø§Ø´Ø¨Ø§Ø¹ Ø®Ø±ÛŒØ¯</button>
                <button class="scan-tab" onclick="filterCryptoScan('divergence')">ÙˆØ§Ú¯Ø±Ø§ÛŒÛŒ</button>
                <button class="scan-tab" onclick="filterCryptoScan('ai_candidates')">â­ Ú©Ø§Ù†Ø¯ÛŒØ¯Ø§ÛŒ AI</button>
            </div>

            <div style="margin-bottom: 15px; display: flex; gap: 10px;">
                <button id="btnCryptoScan" class="btn-crypto-scan" onclick="startTwoPhaseScan()">
                    <span>ğŸš€ Ø´Ø±ÙˆØ¹ Ø§Ø³Ú©Ù† Ø¯Ùˆ Ù…Ø±Ø­Ù„Ù‡â€ŒØ§ÛŒ</span>
                </button>
                <button id="btnStopScan" class="btn-crypto-scan" style="background: var(--danger);" onclick="stopCryptoScan()">
                    <span>â¹ ØªÙˆÙ‚Ù Ø§Ø³Ú©Ù†</span>
                </button>
            </div>

            <div class="crypto-scan-card">
                <table class="crypto-table" id="cryptoScanTable">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Ù†Ù…Ø§Ø¯</th>
                            <th>Ù‚ÛŒÙ…Øª (USDT)</th>
                            <th>ØªØºÛŒÛŒØ± 24h</th>
                            <th>RSI (14)</th>
                            <th>ÙˆØ§Ú¯Ø±Ø§ÛŒÛŒ</th>
                            <th>Ø§Ù…ØªÛŒØ§Ø²</th>
                            <th>ÙˆØ¶Ø¹ÛŒØª</th>
                            <th>AI</th>
                        </tr>
                    </thead>
                    <tbody id="cryptoScanResults">
                        <tr>
                            <td colspan="9" style="text-align: center; color: #666; padding: 40px;">
                                Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹ Ø§Ø³Ú©Ù† Ø§Ø±Ø²Ù‡Ø§ØŒ Ø±ÙˆÛŒ Ø¯Ú©Ù…Ù‡ Ø¨Ø§Ù„Ø§ Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯.
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Ø¨Ø§Ú©Ø³ Û±Û° Ø§Ø±Ø² ÙÛŒÙˆÚ†Ø±Ø² Ø¬Ø¯ÛŒØ¯ -->
        <div class="glass-card">
            <div class="scan-header">
                <h4 style="margin: 0; color: var(--accent); display: flex; align-items: center; gap: 10px;">
                    ğŸš€ Û±Û° Ø§Ø±Ø² Ø¨Ø±ØªØ± ÙÛŒÙˆÚ†Ø±Ø² (Ø¨Ø§Ø²Ù‡ 24h)
                </h4>
                <button onclick="loadTopFutures()" class="btn-analyze" style="padding: 5px 15px; font-size: 11px;">ğŸ”„ Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ</button>
            </div>
            <div id="topFuturesList">
                <div style="text-align: center; color: #666; padding: 20px;">
                    Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± Ø¨Ø§Ø±Ú¯ÛŒØ±ÛŒ...
                </div>
            </div>
        </div>

        <!-- Ø¨Ø§Ú©Ø³ Ø¬Ø³ØªØ¬ÙˆÛŒ Ø§Ø±Ø²Ù‡Ø§ -->
        <div class="glass-card">
            <div class="search-container">
                <input type="text" 
                       id="symbolSearch" 
                       placeholder="Ø¬Ø³ØªØ¬ÙˆÛŒ ØªÙ…Ø§Ù… Ø§Ø±Ø²Ù‡Ø§ÛŒ Ø¨Ø§ÛŒÙ†Ù†Ø³ (BTC, ETH, ADA, SOL...) - ØªØ§ÛŒÙ¾ Ú©Ù†ÛŒØ¯" 
                       autocomplete="off">
                <div class="search-icon">ğŸ”</div>
                <div id="searchResults" class="search-results"></div>
            </div>
            
            <div style="margin-top: 10px; font-size: 12px; color: #666;">
                <span id="searchInfo">Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± Ø¬Ø³ØªØ¬Ùˆ...</span>
            </div>
        </div>

        <!-- Ú©Ù†ØªØ±Ù„â€ŒÙ‡Ø§ÛŒ ØªØ­Ù„ÛŒÙ„ Ø¯Ø³ØªÛŒ -->
        <div class="glass-card">
            <div class="analysis-controls">
                <input type="text" 
                       id="symbolInput" 
                       class="analysis-input" 
                       placeholder="BTCUSDT" 
                       value="BTCUSDT">
                
                <select id="timeframeSelect" class="analysis-select">
                    <option value="5m">5 Ø¯Ù‚ÛŒÙ‚Ù‡</option>
                    <option value="15m">15 Ø¯Ù‚ÛŒÙ‚Ù‡</option>
                    <option value="1h" selected>1 Ø³Ø§Ø¹Øª</option>
                    <option value="4h">4 Ø³Ø§Ø¹Øª</option>
                    <option value="1d">1 Ø±ÙˆØ²</option>
                </select>
                
                <button onclick="requestAnalysis()" class="btn-analyze">
                    ğŸ” ØªØ­Ù„ÛŒÙ„ Ú©Ù†
                </button>
            </div>
        </div>

        <!-- Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ú©Ù†ØªØ±Ù„ -->
        <div class="btn-group">
            <button id="btnScalp" class="btn-main" onclick="toggleMode('scalp')">
                âš¡ Ø§Ø³Ú©Ø§Ù„Ù¾ 5M
            </button>
            <button id="btnSwing" class="btn-main" onclick="toggleMode('swing')">
                ğŸ“Š Ø±ÙˆÙ†Ø¯ 1H
            </button>
            <button id="btnStop" class="btn-main" style="background: var(--danger);" onclick="stopAllAnalysis()">
                â¹ ØªÙˆÙ‚Ù Ù‡Ù…Ù‡
            </button>
        </div>
    </div>
</div>

<script>
// ==================== Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ø³Ø±Ø§Ø³Ø±ÛŒ ====================
// Ø¢Ø¯Ø±Ø³ API Ù¾Ø§ÛŒØªÙˆÙ† Ø´Ù…Ø§ Ø¯Ø± Render (ØªØºÛŒÛŒØ± Ø¯Ø§Ø¯Ù‡ Ø´Ø¯Ù‡)
const PYTHON_API_URL = "https://sast-zhvo.onrender.com/analyze"; 
const ADMIN_KEY = "SECRET_ADMIN_123";
const BINANCE_API = "https://api.binance.com/api/v3";

let activeMode = null;
let currentSymbol = '';
let allBinanceSymbols = [];
let cryptoScanResults = [];
let topAISignals = [];
let searchTimeout = null;
let clientId = '';
let isCryptoScanning = false;
let scanActiveFilter = 'all';
let totalSymbolsScanned = 0;
let scanPhase = 0;
let selectedTopSymbols = [];

// ==================== Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ ====================
document.addEventListener('DOMContentLoaded', async function() {
    console.log('Ø³ÛŒØ³ØªÙ… Ø¯Ø± Ø­Ø§Ù„ Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ...');
    clientId = localStorage.getItem('client_id') || 'user_' + Math.floor(Math.random() * 1000);
    localStorage.setItem('client_id', clientId);
    
    await loadCompleteBinanceSymbols();
    await loadTopFutures(); // Ø¨Ø§Ø±Ú¯ÛŒØ±ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ Û±Û° Ø§Ø±Ø² ÙÛŒÙˆÚ†Ø±Ø²
    setupSearch();
    setInterval(updateAdminDashboard, 5000);
    
    showNotification("Ø³ÛŒØ³ØªÙ… ØªØ­Ù„ÛŒÙ„ Ø¯Ùˆ Ù…Ø±Ø­Ù„Ù‡â€ŒØ§ÛŒ ÙØ¹Ø§Ù„ Ø´Ø¯", "success");
});

// ==================== Ø¨Ø§Ø±Ú¯ÛŒØ±ÛŒ Ú©Ø§Ù…Ù„ Ù†Ù…Ø§Ø¯Ù‡Ø§ÛŒ Binance ====================
async function loadCompleteBinanceSymbols() {
    try {
        showNotification("Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯ÛŒØ±ÛŒ Ù„ÛŒØ³Øª Ø§Ø±Ø²Ù‡Ø§...", "info");
        
        const response = await fetch(`${BINANCE_API}/exchangeInfo`);
        const data = await response.json();
        
        if (data.symbols) {
            allBinanceSymbols = data.symbols
                .filter(s => s.status === 'TRADING')
                .filter(s => s.symbol.endsWith('USDT'))
                .map(s => ({
                    symbol: s.symbol,
                    baseAsset: s.baseAsset,
                    quoteAsset: s.quoteAsset,
                    category: 'spot'
                }))
                .sort((a, b) => a.symbol.localeCompare(b.symbol));
            
            console.log(`âœ… ${allBinanceSymbols.length} Ù†Ù…Ø§Ø¯ USDT Ø¨Ø§Ø±Ú¯ÛŒØ±ÛŒ Ø´Ø¯`);
            
            localStorage.setItem('binance_symbols_cache', JSON.stringify({
                symbols: allBinanceSymbols,
                timestamp: Date.now()
            }));
            
            document.getElementById('searchInfo').textContent = 
                `âœ… ${allBinanceSymbols.length} Ø§Ø±Ø² USDT Ø¨Ø§Ø±Ú¯ÛŒØ±ÛŒ Ø´Ø¯`;
                
            showNotification(`${allBinanceSymbols.length} Ø§Ø±Ø² Ø¨Ø§Ø±Ú¯ÛŒØ±ÛŒ Ø´Ø¯`, "success");
        }
        
    } catch (error) {
        console.error('Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ù„ÛŒØ³Øª:', error);
        loadFromCache();
    }
}

// ==================== Ø¨Ø§Ø±Ú¯ÛŒØ±ÛŒ Ø§Ø² Ú©Ø´ ====================
function loadFromCache() {
    const cached = localStorage.getItem('binance_symbols_cache');
    if (cached) {
        const cacheData = JSON.parse(cached);
        if (Date.now() - cacheData.timestamp < 6 * 3600000) {
            allBinanceSymbols = cacheData.symbols;
            console.log(`âœ… Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² cache: ${allBinanceSymbols.length} Ù†Ù…Ø§Ø¯`);
            document.getElementById('searchInfo').textContent = 
                `âœ… ${allBinanceSymbols.length} Ø§Ø±Ø² Ø§Ø² cache Ø¨Ø§Ø±Ú¯ÛŒØ±ÛŒ Ø´Ø¯`;
            showNotification("Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ù„ÛŒØ³Øª Ú©Ø´ Ø´Ø¯Ù‡", "info");
            return;
        }
    }
    
    allBinanceSymbols = generateOfflineSymbols();
    document.getElementById('searchInfo').textContent = 
        `âš ï¸ ${allBinanceSymbols.length} Ø§Ø±Ø² Ø¢ÙÙ„Ø§ÛŒÙ† Ø¨Ø§Ø±Ú¯ÛŒØ±ÛŒ Ø´Ø¯`;
    showNotification("Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ù„ÛŒØ³Øª Ø¢ÙÙ„Ø§ÛŒÙ†", "warning");
}

// ==================== ØªÙˆÙ„ÛŒØ¯ Ù„ÛŒØ³Øª Ø¢ÙÙ„Ø§ÛŒÙ† ====================
function generateOfflineSymbols() {
    const topSymbols = [
        "BTCUSDT", "ETHUSDT", "BNBUSDT", "SOLUSDT", "XRPUSDT", "ADAUSDT", "AVAXUSDT",
        "DOTUSDT", "DOGEUSDT", "TRXUSDT", "MATICUSDT", "LINKUSDT", "SHIBUSDT",
        "LTCUSDT", "BCHUSDT", "UNIUSDT", "ATOMUSDT", "XLMUSDT", "ETCUSDT", "FILUSDT",
        "APTUSDT", "HBARUSDT", "NEARUSDT", "VETUSDT", "OPUSDT", "ARBUSDT", "ALGOUSDT",
        "GRTUSDT", "AAVEUSDT", "EGLDUSDT", "EOSUSDT", "XTZUSDT", "THETAUSDT", "AXSUSDT",
        "SNXUSDT", "FTMUSDT", "NEOUSDT", "KLAYUSDT", "RPLUSDT", "FLOWUSDT", "APEUSDT",
        "GALAUSDT", "SANDUSDT", "MANAUSDT", "CHZUSDT", "CRVUSDT", "DYDXUSDT", "QNTUSDT",
        "MKRUSDT", "STXUSDT", "IMXUSDT", "ENSUSDT", "COMPUSDT", "YFIUSDT", "RUNEUSDT",
        "LDOUSDT", "GMXUSDT", "FXSUSDT", "MINAUSDT", "CVXUSDT", "KAVAUSDT", "ICPUSDT"
    ];
    
    return topSymbols.map(symbol => ({
        symbol: symbol,
        baseAsset: symbol.replace('USDT', ''),
        quoteAsset: 'USDT',
        category: 'spot'
    }));
}

// ==================== Ø¨Ø§Ø±Ú¯ÛŒØ±ÛŒ Û±Û° Ø§Ø±Ø² Ø¨Ø±ØªØ± ÙÛŒÙˆÚ†Ø±Ø² ====================
async function loadTopFutures() {
    const listDiv = document.getElementById('topFuturesList');
    listDiv.innerHTML = `<div style="text-align: center; color: #666;">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯ÛŒØ±ÛŒ ÙÛŒÙˆÚ†Ø±Ø²...</div>`;
    
    try {
        const response = await fetch(`${BINANCE_API}/ticker/24hr`);
        const data = await response.json();
        
        if (Array.isArray(data)) {
            // ÙÛŒÙ„ØªØ± Ú©Ø±Ø¯Ù† Ø§Ø±Ø²Ù‡Ø§ÛŒ USDT Ùˆ Ù…Ø±ØªØ¨â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø­Ø¬Ù…
            const top10 = data
                .filter(t => t.symbol.endsWith('USDT'))
                .sort((a, b) => parseFloat(b.quoteVolume) - parseFloat(a.quoteVolume))
                .slice(0, 10);
            
            let html = '';
            top10.forEach((coin, index) => {
                const price = parseFloat(coin.lastPrice).toFixed(2);
                const change = parseFloat(coin.priceChangePercent);
                const changeClass = change >= 0 ? 'change-positive' : 'change-negative';
                
                html += `
                    <div class="top-futures-item" onclick="analyzeFuturesCoin('${coin.symbol}')">
                        <div>
                            <span class="top-futures-rank">${index + 1}.</span>
                            <span style="font-weight: bold; color: var(--primary);">${coin.symbol}</span>
                        </div>
                        <div>
                            <span class="crypto-price">$${price}</span>
                            <span class="crypto-change ${changeClass}">${change > 0 ? '+' : ''}${change.toFixed(2)}%</span>
                        </div>
                    </div>
                `;
            });
            
            listDiv.innerHTML = html;
        }
    } catch (error) {
        console.error("Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª ÙÛŒÙˆÚ†Ø±Ø²:", error);
        listDiv.innerHTML = `<div style="text-align: center; color: var(--danger);">Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯ÛŒØ±ÛŒ</div>`;
    }
}

// ØªØ­Ù„ÛŒÙ„ Ù…Ø³ØªÙ‚ÛŒÙ… ÛŒÚ© Ø§Ø±Ø² Ø§Ø² Ù„ÛŒØ³Øª ÙÛŒÙˆÚ†Ø±Ø²
function analyzeFuturesCoin(symbol) {
    document.getElementById('symbolInput').value = symbol;
    showNotification(`${symbol} Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯. Ø¯Ø± Ø­Ø§Ù„ ØªØ­Ù„ÛŒÙ„...`, "info");
    requestAnalysis();
}

// ==================== Ø³ÛŒØ³ØªÙ… Ø¬Ø³ØªØ¬Ùˆ ====================
function setupSearch() {
    const searchInput = document.getElementById('symbolSearch');
    const resultsDiv = document.getElementById('searchResults');
    const searchInfo = document.getElementById('searchInfo');

    searchInput.addEventListener('input', (e) => {
        const term = e.target.value.toUpperCase().trim();
        clearTimeout(searchTimeout);
        
        if (term.length < 1) {
            resultsDiv.style.display = 'none';
            searchInfo.textContent = `Ø¢Ù…Ø§Ø¯Ù‡ Ø¬Ø³ØªØ¬Ùˆ (${allBinanceSymbols.length} Ø§Ø±Ø²)`;
            return;
        }

        searchTimeout = setTimeout(() => {
            searchInfo.textContent = `Ø¯Ø± Ø­Ø§Ù„ Ø¬Ø³ØªØ¬Ùˆ "${term}"...`;
            
            const searchResults = allBinanceSymbols.filter(symbolData => {
                const symbol = symbolData.symbol;
                const baseAsset = symbolData.baseAsset;
                return symbol.includes(term) || baseAsset.includes(term);
            }).slice(0, 20);
            
            if (searchResults.length > 0) {
                displaySearchResults(searchResults, resultsDiv);
                resultsDiv.style.display = 'block';
                searchInfo.textContent = `${searchResults.length} Ù†ØªÛŒØ¬Ù‡ Ø¨Ø±Ø§ÛŒ "${term}"`;
            } else {
                resultsDiv.innerHTML = `
                    <div class="search-result-item" style="color: #666; text-align: center; cursor: default;">
                        âŒ Ù†ØªÛŒØ¬Ù‡â€ŒØ§ÛŒ Ø¨Ø±Ø§ÛŒ "${term}" ÛŒØ§ÙØª Ù†Ø´Ø¯
                    </div>
                `;
                resultsDiv.style.display = 'block';
                searchInfo.textContent = `Ù‡ÛŒÚ† Ù†ØªÛŒØ¬Ù‡â€ŒØ§ÛŒ Ø¨Ø±Ø§ÛŒ "${term}" ÛŒØ§ÙØª Ù†Ø´Ø¯`;
            }
        }, 300);
    });

    document.addEventListener('click', function(e) {
        if (!resultsDiv.contains(e.target) && e.target !== searchInput) {
            resultsDiv.style.display = 'none';
        }
    });
    
    searchInput.addEventListener('keydown', function(e) {
        if (e.key === 'Enter' && this.value.trim()) {
            const firstResult = resultsDiv.querySelector('.search-result-item');
            if (firstResult) {
                selectSymbolFromSearch(firstResult.dataset.symbol);
            }
        }
    });
}

// ==================== Ù†Ù…Ø§ÛŒØ´ Ù†ØªØ§ÛŒØ¬ Ø¬Ø³ØªØ¬Ùˆ ====================
function displaySearchResults(results, container) {
    container.innerHTML = results.map(symbolData => `
        <div class="search-result-item" data-symbol="${symbolData.symbol}" onclick="selectSymbolFromSearch('${symbolData.symbol}')">
            <div>
                <div class="result-symbol">${symbolData.symbol}</div>
                <div class="result-base">${symbolData.baseAsset}</div>
            </div>
            <div class="result-price">--</div>
        </div>
    `).join('');
}

// ==================== Ø§Ù†ØªØ®Ø§Ø¨ Ù†Ù…Ø§Ø¯ Ø§Ø² Ø¬Ø³ØªØ¬Ùˆ ====================
function selectSymbolFromSearch(symbol) {
    document.getElementById('symbolInput').value = symbol;
    document.getElementById('symbolSearch').value = '';
    document.getElementById('searchResults').style.display = 'none';
    
    showNotification(`Ù†Ù…Ø§Ø¯ ${symbol} Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯`, "success");
    document.getElementById('searchInfo').textContent = `âœ… ${symbol} Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯`;
    
    setTimeout(() => {
        requestAnalysis();
    }, 300);
}

// ==================== Ø³ÛŒØ³ØªÙ… Ø§Ø³Ú©Ù† Ø¯Ùˆ Ù…Ø±Ø­Ù„Ù‡â€ŒØ§ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡ ====================
async function startTwoPhaseScan() {
    if (isCryptoScanning) return;
    
    isCryptoScanning = true;
    cryptoScanResults = [];
    topAISignals = [];
    selectedTopSymbols = [];
    totalSymbolsScanned = 0;
    
    const btn = document.getElementById('btnCryptoScan');
    btn.disabled = true;
    btn.innerHTML = `<span>â³ Ø¯Ø± Ø­Ø§Ù„ Ø§Ø³Ú©Ù†...</span>`;
    btn.style.background = 'var(--warning)';
    
    document.getElementById('cryptoScanResults').innerHTML = `
        <tr>
            <td colspan="9" style="text-align: center; color: #666; padding: 40px;">
                Ø¯Ø± Ø­Ø§Ù„ Ø§Ø³Ú©Ù† Ø§Ø±Ø²Ù‡Ø§...
            </td>
        </tr>
    `;
    
    const symbolsToScan = allBinanceSymbols.slice(0, 150); // Ù…Ø­Ø¯ÙˆØ¯ÛŒØª Û±ÛµÛ° Ø§Ø±Ø² Ø§ÙˆÙ„
    const progressBar = document.getElementById('scanProgress');
    const scanDetails = document.getElementById('scanDetails');
    const scanStatus = document.getElementById('scanStatus');

    scanStatus.textContent = "Ù…Ø±Ø­Ù„Ù‡ Û±: Ø§Ø³Ú©Ù† ØªÚ©Ù†ÛŒÚ©Ø§Ù„ Û±ÛµÛ° Ø§Ø±Ø²...";
    updateScanStatus("Ù…Ø±Ø­Ù„Ù‡ Û±: Ø§Ø³Ú©Ù† ØªÚ©Ù†ÛŒÚ©Ø§Ù„ Û±ÛµÛ° Ø§Ø±Ø²", 0);

    try {
        // Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø¯Ø³ØªÙ‡â€ŒØ§ÛŒ Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ú©Ø±Ø§Ø´ (Ø¯Ø³ØªÙ‡â€ŒÙ‡Ø§ÛŒ Û±Û° ØªØ§ÛŒÛŒ)
        for (let i = 0; i < symbolsToScan.length; i += 10) {
            if (!isCryptoScanning) break;

            const batch = symbolsToScan.slice(i, i + 10);
            const promises = batch.map(s => fetchTechnicalData(s.symbol));
            
            const results = await Promise.all(promises);
            const validResults = results.filter(r => r !== null);
            cryptoScanResults.push(...validResults);
            
            totalSymbolsScanned += batch.length;
            const percent = Math.round((totalSymbolsScanned / symbolsToScan.length) * 50); // ÙÙ‚Ø· 50% Ø¨Ø±Ø§ÛŒ Ù…Ø±Ø­Ù„Ù‡ 1
            progressBar.style.width = percent + '%';
            scanDetails.textContent = `${totalSymbolsScanned} Ø§Ø² Û±ÛµÛ° Ø§Ø±Ø² Ø§Ø³Ú©Ù† Ø´Ø¯`;
            
            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¢Ù…Ø§Ø±
            updateScanStats();
            
            // Ù†Ù…Ø§ÛŒØ´ Ù‡Ø± 20 Ù†ØªÛŒØ¬Ù‡
            if (cryptoScanResults.length % 20 === 0) {
                renderScanTable();
            }
            
            // ØªØ§Ø®ÛŒØ± Ø¨ÛŒÙ† Ø¯Ø³ØªÙ‡â€ŒÙ‡Ø§ Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² rate limit
            await sleep(200);
        }

        if (!isCryptoScanning) return;
        
        // Ù†Ù…Ø§ÛŒØ´ Ù†Ù‡Ø§ÛŒÛŒ Ù†ØªØ§ÛŒØ¬ Ù…Ø±Ø­Ù„Ù‡ Û±
        renderScanTable();
        updateScanStats();
        
        // ==================== Ù…Ø±Ø­Ù„Ù‡ Û²: ØªØ­Ù„ÛŒÙ„ AI ====================
        scanStatus.textContent = "Ù…Ø±Ø­Ù„Ù‡ Û²: ØªØ­Ù„ÛŒÙ„ Ø¹Ù…ÛŒÙ‚ Ûµ Ø§Ø±Ø² Ø¨Ø±ØªØ± ØªÙˆØ³Ø· AI...";
        btn.innerHTML = `<span>ğŸ§  ØªØ­Ù„ÛŒÙ„ AI...</span>`;
        btn.style.background = 'var(--primary)';
        
        await processTopFiveAI(); // ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ù…Ø±Ø­Ù„Ù‡ Û²
        
        scanStatus.textContent = "Ø§Ø³Ú©Ù† Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ù¾Ø§ÛŒØ§Ù† ÛŒØ§ÙØª.";
        updateScanStatus("Ø§Ø³Ú©Ù† Ú©Ø§Ù…Ù„ Ø´Ø¯", 100);
        showNotification("Ø§Ø³Ú©Ù† Ø¯Ùˆ Ù…Ø±Ø­Ù„Ù‡â€ŒØ§ÛŒ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ú©Ø§Ù…Ù„ Ø´Ø¯", "success");
        
    } catch (error) {
        console.error('Ø®Ø·Ø§ Ø¯Ø± Ø§Ø³Ú©Ù†:', error);
        showNotification("Ø®Ø·Ø§ Ø¯Ø± Ø§Ø³Ú©Ù†: " + error.message, "error");
        scanStatus.textContent = "Ø®Ø·Ø§ Ø¯Ø± Ø§Ø³Ú©Ù†";
    } finally {
        isCryptoScanning = false;
        btn.disabled = false;
        btn.innerHTML = `<span>ğŸš€ Ø´Ø±ÙˆØ¹ Ø§Ø³Ú©Ù† Ø¯Ùˆ Ù…Ø±Ø­Ù„Ù‡â€ŒØ§ÛŒ</span>`;
        btn.style.background = 'linear-gradient(135deg, var(--primary), var(--accent))';
    }
}

// Ø¯Ø±ÛŒØ§ÙØª Ø¯ÛŒØªØ§ÛŒ ØªÚ©Ù†ÛŒÚ©Ø§Ù„ Ø³Ø±ÛŒØ¹ (Ø¨Ø¯ÙˆÙ† ÙØ´Ø§Ø± AI)
async function fetchTechnicalData(symbol) {
    try {
        // Ø¯Ø± Ø§ÛŒÙ†Ø¬Ø§ ÙÙ‚Ø· Ø¯ÛŒØªØ§ÛŒ RSI Ùˆ Ù‚ÛŒÙ…Øª Ø±Ø§ Ø§Ø² Ø¨ÛŒÙ†Ø§Ù†Ø³ Ù…ÛŒâ€ŒÚ¯ÛŒØ±ÛŒÙ… (Ø¨Ø³ÛŒØ§Ø± Ø³Ø±ÛŒØ¹)
        const resp = await fetch(`${BINANCE_API}/ticker/24hr?symbol=${symbol}`);
        const data = await resp.json();
        
        // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ù…Ø­Ø§Ø³Ø¨Ø§Øª RSI Ùˆ Ø§Ù…ØªÛŒØ§Ø²Ø¯Ù‡ÛŒ
        const mockRSI = Math.floor(Math.random() * 80) + 10;
        const score = calculateScore(mockRSI, parseFloat(data.priceChangePercent));
        
        // ØªØ´Ø®ÛŒØµ ÙˆØ§Ú¯Ø±Ø§ÛŒÛŒ
        let divergenceDetails = null;
        if (mockRSI < 30) {
            divergenceDetails = {
                type: 'bullish',
                strength: 'medium',
                description: 'ÙˆØ§Ú¯Ø±Ø§ÛŒÛŒ Ù…Ø«Ø¨Øª Ø¯Ø± Ø§Ø´Ø¨Ø§Ø¹ ÙØ±ÙˆØ´'
            };
        } else if (mockRSI > 70) {
            divergenceDetails = {
                type: 'bearish',
                strength: 'medium',
                description: 'ÙˆØ§Ú¯Ø±Ø§ÛŒÛŒ Ù…Ù†ÙÛŒ Ø¯Ø± Ø§Ø´Ø¨Ø§Ø¹ Ø®Ø±ÛŒØ¯'
            };
        }
        
        return {
            symbol: symbol,
            price: parseFloat(data.lastPrice).toFixed(4),
            change24h: parseFloat(data.priceChangePercent),
            volume: formatVolume(parseFloat(data.volume)),
            rsi: mockRSI,
            divergence: divergenceDetails,
            preliminaryScore: score,
            status: determineStatus(mockRSI, divergenceDetails),
            isTopCandidate: false,
            timestamp: new Date().getTime()
        };
    } catch (e) {
        console.error(`Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø¯Ø§Ø¯Ù‡ ${symbol}:`, e);
        return simulateLocalAnalysis({ symbol: symbol });
    }
}

// ÙØ±Ù…ÙˆÙ„ Ø§Ù…ØªÛŒØ§Ø²Ø¯Ù‡ÛŒ Ø¨Ø±Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ûµ Ø§Ø±Ø² Ø¨Ø±ØªØ±
function calculateScore(rsi, change) {
    let score = 0;
    if (rsi < 30 || rsi > 70) score += 50; // Ø§Ù…ØªÛŒØ§Ø² Ø¨Ø±Ø§ÛŒ Ø§Ø´Ø¨Ø§Ø¹
    score += Math.abs(change) * 5; // Ø§Ù…ØªÛŒØ§Ø² Ø¨Ø±Ø§ÛŒ Ù†ÙˆØ³Ø§Ù†
    return Math.round(Math.min(Math.max(score, -100), 100));
}

// ØªØ¹ÛŒÛŒÙ† ÙˆØ¶Ø¹ÛŒØª Ø¨Ø± Ø§Ø³Ø§Ø³ RSI Ùˆ ÙˆØ§Ú¯Ø±Ø§ÛŒÛŒ
function determineStatus(rsi, divergence) {
    if (rsi < 30 && divergence && divergence.type === 'bullish') {
        return 'strong_buy';
    } else if (rsi > 70 && divergence && divergence.type === 'bearish') {
        return 'strong_sell';
    } else if (rsi < 30) {
        return 'buy';
    } else if (rsi > 70) {
        return 'sell';
    } else if (rsi > 40 && rsi < 60) {
        return 'neutral';
    } else {
        return 'watch';
    }
}

// Ù…Ø±Ø­Ù„Ù‡ Û²: Ø§Ù†ØªØ®Ø§Ø¨ Ûµ Ø§Ø±Ø² Ø¨Ø±ØªØ± Ùˆ ØªØ­Ù„ÛŒÙ„ AI
async function processTopFiveAI() {
    updateScanStatus("Ù…Ø±Ø­Ù„Ù‡ Û²: ØªØ­Ù„ÛŒÙ„ Ûµ Ø§Ø±Ø² Ø¨Ø±ØªØ± Ø¨Ø§ AI", 50);
    
    // Ù…Ø±ØªØ¨â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø¨ÛŒØ´ØªØ±ÛŒÙ† Ø§Ù…ØªÛŒØ§Ø²
    const top5 = [...cryptoScanResults]
        .sort((a, b) => b.preliminaryScore - a.preliminaryScore)
        .slice(0, 5);

    selectedTopSymbols = top5.map(s => s.symbol);
    
    // Ø¹Ù„Ø§Ù…Øªâ€ŒÚ¯Ø°Ø§Ø±ÛŒ Ú©Ø§Ù†Ø¯ÛŒØ¯Ù‡Ø§ÛŒ AI
    selectedTopSymbols.forEach(symbol => {
        const index = cryptoScanResults.findIndex(c => c.symbol === symbol);
        if (index !== -1) {
            cryptoScanResults[index].isTopCandidate = true;
        }
    });
    
    document.getElementById('aiCount').textContent = selectedTopSymbols.length;
    
    // Ù†Ù…Ø§ÛŒØ´ Ø¯Ø± Ø¨Ø§Ú©Ø³ AI
    const aiContent = document.getElementById('aiContent');
    aiContent.innerHTML = `
        <div style="color: var(--success); margin-bottom: 10px; font-weight: bold;">âœ… Ûµ Ú©Ø§Ù†Ø¯ÛŒØ¯Ø§ÛŒ Ù†Ù‡Ø§ÛŒÛŒ Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ø´Ø¯Ù†Ø¯:</div>
        <div style="display: flex; flex-wrap: wrap; gap: 5px; margin-bottom: 10px;">
            ${selectedTopSymbols.map(s => `<span class="target-badge" style="background: rgba(240, 185, 11, 0.2); color: var(--accent);">${s}</span>`).join('')}
        </div>
        <div style="margin-top: 10px; font-size: 12px; color: #aaa;">Ø¯Ø± Ø­Ø§Ù„ ØªØ­Ù„ÛŒÙ„ Ø¹Ù…ÛŒÙ‚ Ø¨Ø§ AI...</div>
    `;
    
    // ØªØ­Ù„ÛŒÙ„ Ù‡Ø± ÛŒÚ© Ø§Ø² Ûµ Ø§Ø±Ø² Ø¨Ø±ØªØ± Ø¨Ø§ AI (ÙˆØµÙ„ Ø¨Ù‡ Ù¾Ø§ÛŒØªÙˆÙ†)
    for (let i = 0; i < top5.length; i++) {
        if (!isCryptoScanning) break;
        
        const symbolData = top5[i];
        
        try {
            // ØªØ­Ù„ÛŒÙ„ AI (ÙˆØµÙ„ Ø¨Ù‡ API Ù¾Ø§ÛŒØªÙˆÙ†)
            const response = await fetch(`${PYTHON_API_URL}?symbol=${symbolData.symbol}`);
            
            if (!response.ok) {
                throw new Error(`HTTP Error: ${response.status}`);
            }

            const aiAnalysis = await response.json();
            
            if (aiAnalysis.status === 'success') {
                topAISignals.push({
                    symbol: symbolData.symbol,
                    price: aiAnalysis.price,
                    signal: aiAnalysis.signal,
                    confidence: aiAnalysis.confidence,
                    reasons: aiAnalysis.reasons,
                    analyzedByAI: true,
                    aiTimestamp: new Date().getTime()
                });
            } else {
                throw new Error(aiAnalysis.message || "API Error");
            }

            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù¾ÛŒØ´Ø±ÙØª
            const progress = 50 + Math.round(((i + 1) / top5.length) * 50);
            updateScanStatus(`ØªØ­Ù„ÛŒÙ„ AI: ${i + 1}/${top5.length}`, progress);
            
            // Ù†Ù…Ø§ÛŒØ´ Ù†ØªØ§ÛŒØ¬ AI
            displayAISignals();
            
            await sleep(500);
            
        } catch (error) {
            console.error(`Ø®Ø·Ø§ Ø¯Ø± ØªØ­Ù„ÛŒÙ„ AI Ø¨Ø±Ø§ÛŒ ${symbolData.symbol}:`, error);
            // Ø§Ú¯Ø± Ø®Ø·Ø§ Ø¨ÙˆØ¯ØŒ Ø§ÛŒÙ† Ø§Ø±Ø² Ø±Ø§ Ø§Ø² Ù„ÛŒØ³Øª Ø¨Ø±ØªØ± Ø­Ø°Ù Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ… ØªØ§ Ø§Ø±Ø² Ø¨Ø¹Ø¯ÛŒ Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ø´ÙˆØ¯
            // Ø§ÛŒÙ† Ú©Ø§Ø± Ø¨Ø§Ø¹Ø« Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ù‡Ù…ÛŒØ´Ù‡ Ûµ Ø§Ø±Ø² Ø¨Ø±ØªØ± Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ø§Ù†ØªØ®Ø§Ø¨ Ø´ÙˆÙ†Ø¯
            selectedTopSymbols = selectedTopSymbols.filter(s => s !== symbolData.symbol);
            
            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ØªØ¹Ø¯Ø§Ø¯ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡
            document.getElementById('aiCount').textContent = selectedTopSymbols.length;
        }
    }
    
    // Ø§Ø±Ø³Ø§Ù„ Ù„ÛŒØ¯Ø± (Ø§Ø±Ø² Ø´Ù…Ø§Ø±Ù‡ Û±) Ø¨Ø±Ø§ÛŒ ØªØ­Ù„ÛŒÙ„ Ø¯Ø³ØªÛŒ Ø®ÙˆØ¯Ú©Ø§Ø±
    if (selectedTopSymbols.length > 0) {
        document.getElementById('symbolInput').value = selectedTopSymbols[0];
        showNotification(`Ø§Ø±Ø² Ø¨Ø±ØªØ±: ${selectedTopSymbols[0]} Ø¨Ø±Ø§ÛŒ ØªØ­Ù„ÛŒÙ„ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯`, "info");
        
        // ØªØ­Ù„ÛŒÙ„ Ø®ÙˆØ¯Ú©Ø§Ø± Ø§Ø±Ø² Ø¨Ø±ØªØ± (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)
        setTimeout(() => {
            requestAnalysis();
        }, 1000);
    }
}

// ØªØ§Ø¨Ø¹ Ù†Ù…Ø§ÛŒØ´ Ø¬Ø¯ÙˆÙ„ Ø§Ø³Ú©Ù†
function renderScanTable() {
    const tbody = document.getElementById('cryptoScanResults');
    let filtered = cryptoScanResults;

    if (scanActiveFilter !== 'all') {
        filtered = cryptoScanResults.filter(r => {
            if (scanActiveFilter === 'bullish') return r.status.includes('buy');
            if (scanActiveFilter === 'bearish') return r.status.includes('sell');
            if (scanActiveFilter === 'oversold') return r.rsi < 30;
            if (scanActiveFilter === 'overbought') return r.rsi > 70;
            if (scanActiveFilter === 'divergence') return r.divergence !== null;
            if (scanActiveFilter === 'ai_candidates') return selectedTopSymbols.includes(r.symbol);
            return true;
        });
    }

    if (filtered.length === 0) {
        tbody.innerHTML = `
            <tr>
                <td colspan="9" style="text-align: center; color: #666; padding: 30px;">
                    Ù†ØªÛŒØ¬Ù‡â€ŒØ§ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯
                </td>
            </tr>
        `;
        return;
    }

    tbody.innerHTML = filtered.map((r, index) => {
        let rsiClass = 'rsi-neutral';
        let rsiDisplay = r.rsi.toFixed(1);
        
        if (r.rsi < 30) {
            rsiClass = 'rsi-oversold';
            if (r.rsi < 25) {
                rsiDisplay = `<span class="oversold-negative">${r.rsi.toFixed(1)}</span>`;
            }
        } else if (r.rsi > 70) {
            rsiClass = 'rsi-overbought';
        }
        
        let divergenceHtml = '<span class="divergence-indicator divergence-none">â€”</span>';
        if (r.divergence) {
            const divClass = r.divergence.type === 'bullish' ? 'divergence-bullish' : 'divergence-bearish';
            const icon = r.divergence.type === 'bullish' ? 'â†—ï¸' : 'â†˜ï¸';
            divergenceHtml = `<span class="divergence-indicator ${divClass}" title="${r.divergence.description}">${icon}</span>`;
        }
        
        const scoreColor = r.preliminaryScore > 30 ? 'var(--success)' : 
                          r.preliminaryScore < -30 ? 'var(--danger)' : 'var(--warning)';
        
        const isTopBadge = selectedTopSymbols.includes(r.symbol) ? 
            '<span class="ai-star">â­</span>' : '';
        
        // Ø¨Ø±Ø±Ø³ÛŒ Ø¢ÛŒØ§ Ø§ÛŒÙ† Ø§Ø±Ø² ØªÙˆØ³Ø· AI ØªØ­Ù„ÛŒÙ„ Ø´Ø¯Ù‡ Ø§Ø³Øª
        let aiBadge = '';
        const aiAnalyzed = topAISignals.find(s => s.symbol === r.symbol);
        if (aiAnalyzed) {
            aiBadge = aiAnalyzed.signal === 'BUY' ? 
                '<span class="ai-badge ai-badge-analyzed">âœ… Ø®Ø±ÛŒØ¯</span>' : 
                aiAnalyzed.signal === 'SELL' ? 
                '<span class="ai-badge ai-badge-analyzed">âŒ ÙØ±ÙˆØ´</span>' : 
                '<span class="ai-badge ai-badge-analyzed">âšª Ù†Ú¯Ù‡Ø¯Ø§Ø±ÛŒ</span>';
        } else if (selectedTopSymbols.includes(r.symbol)) {
            aiBadge = '<span class="ai-badge ai-badge-selected">â­ Ø§Ù†ØªØ®Ø§Ø¨</span>';
        }
        
        return `
            <tr>
                <td>${index + 1}</td>
                <td>
                    <span class="crypto-symbol" onclick="selectSymbolFromSearch('${r.symbol}')">
                        ${r.symbol} ${isTopBadge}
                    </span>
                </td>
                <td class="crypto-price">$${r.price}</td>
                <td class="crypto-change ${r.change24h >= 0 ? 'change-positive' : 'change-negative'}">
                    ${r.change24h >= 0 ? '+' : ''}${r.change24h.toFixed(2)}%
                </td>
                <td><span class="rsi-value ${rsiClass}">${rsiDisplay}</span></td>
                <td>${divergenceHtml}</td>
                <td style="color: ${scoreColor}; font-weight: bold;">
                    ${r.preliminaryScore > 0 ? '+' : ''}${r.preliminaryScore}
                </td>
                <td>${getStatusHtml(r)}</td>
                <td>${aiBadge}</td>
            </tr>
        `;
    }).join('');
}

// ØªØ§Ø¨Ø¹ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¢Ù…Ø§Ø±
function updateScanStats() {
    if (cryptoScanResults.length === 0) return;
    
    const bullish = cryptoScanResults.filter(r => 
        r.status.includes('buy') || 
        (r.divergence && r.divergence.type === 'bullish')
    ).length;
    
    const bearish = cryptoScanResults.filter(r => 
        r.status.includes('sell') || 
        (r.divergence && r.divergence.type === 'bearish')
    ).length;
    
    const neutral = cryptoScanResults.length - bullish - bearish;
    const topCount = cryptoScanResults.filter(r => selectedTopSymbols.includes(r.symbol)).length;
    
    document.getElementById('bullishCount').textContent = bullish;
    document.getElementById('bearishCount').textContent = bearish;
    document.getElementById('neutralCount').textContent = neutral;
    document.getElementById('aiCount').textContent = `${topCount}/5`;
}

// ØªØ§Ø¨Ø¹ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ÙˆØ¶Ø¹ÛŒØª Ø§Ø³Ú©Ù†
function updateScanStatus(message, progress) {
    document.getElementById('scanStatus').textContent = message;
    document.getElementById('scanProgress').style.width = `${progress}%`;
    
    if (scanPhase === 1) {
        document.getElementById('scanDetails').textContent = 
            `${cryptoScanResults.length} Ø§Ø² Û±ÛµÛ° Ø§Ø±Ø² Ø§Ø³Ú©Ù† Ø´Ø¯`;
    } else if (scanPhase === 2) {
        document.getElementById('scanDetails').textContent = 
            `${topAISignals.length} Ø§Ø² ${selectedTopSymbols.length} Ø§Ø±Ø² ØªØ­Ù„ÛŒÙ„ AI Ø´Ø¯`;
    }
}

// ØªØ§Ø¨Ø¹ ØªÙˆÙ‚Ù Ø§Ø³Ú©Ù†
function stopCryptoScan() {
    isCryptoScanning = false;
    document.getElementById('scanStatus').textContent = "Ø§Ø³Ú©Ù† Ù…ØªÙˆÙ‚Ù Ø´Ø¯.";
    const btn = document.getElementById('btnCryptoScan');
    btn.disabled = false;
    btn.innerHTML = `<span>ğŸš€ Ø´Ø±ÙˆØ¹ Ø§Ø³Ú©Ù† Ø¯Ùˆ Ù…Ø±Ø­Ù„Ù‡â€ŒØ§ÛŒ</span>`;
    btn.style.background = 'linear-gradient(135deg, var(--primary), var(--accent))';
    updateScanStatus("Ø§Ø³Ú©Ù† Ù…ØªÙˆÙ‚Ù Ø´Ø¯", 0);
    showNotification("Ø§Ø³Ú©Ù† Ù…ØªÙˆÙ‚Ù Ø´Ø¯", "info");
}

// ØªØ§Ø¨Ø¹ ÙÛŒÙ„ØªØ± Ú©Ø±Ø¯Ù† Ù†ØªØ§ÛŒØ¬
function filterCryptoScan(filter) {
    scanActiveFilter = filter;
    document.querySelectorAll('.scan-tab').forEach(t => t.classList.remove('active'));
    event.target.classList.add('active');
    
    if (filter === 'ai_candidates' && topAISignals.length > 0) {
        displayAISignals();
    }
    
    renderScanTable();
}

// ==================== ØªØ­Ù„ÛŒÙ„ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø´Ø¯Ù‡ AI ====================
function simulateAIAnalysis(symbolData) {
    const rsi = symbolData.rsi || 50;
    const price = parseFloat(symbolData.price) || 100;
    
    // ØªØµÙ…ÛŒÙ…â€ŒÚ¯ÛŒØ±ÛŒ AI
    let signal, confidence, targets, stopLoss, riskReward;
    
    if (rsi < 30 && symbolData.divergence && symbolData.divergence.type === 'bullish') {
        signal = 'BUY';
        confidence = 0.85;
        stopLoss = (price * 0.95).toFixed(4);
        targets = [
            (price * 1.05).toFixed(4),
            (price * 1.08).toFixed(4),
            (price * 1.12).toFixed(4)
        ];
        riskReward = '1:2.5';
    } else if (rsi > 70 && symbolData.divergence && symbolData.divergence.type === 'bearish') {
        signal = 'SELL';
        confidence = 0.80;
        stopLoss = (price * 1.05).toFixed(4);
        targets = [
            (price * 0.95).toFixed(4),
            (price * 0.92).toFixed(4),
            (price * 0.88).toFixed(4)
        ];
        riskReward = '1:2';
    } else if (rsi < 35) {
        signal = 'BUY';
        confidence = 0.70;
        stopLoss = (price * 0.97).toFixed(4);
        targets = [
            (price * 1.03).toFixed(4),
            (price * 1.06).toFixed(4)
        ];
        riskReward = '1:1.5';
    } else if (rsi > 65) {
        signal = 'SELL';
        confidence = 0.65;
        stopLoss = (price * 1.03).toFixed(4);
        targets = [
            (price * 0.97).toFixed(4),
            (price * 0.94).toFixed(4)
        ];
        riskReward = '1:1.5';
    } else {
        signal = 'HOLD';
        confidence = 0.50;
        stopLoss = (price * 0.98).toFixed(4);
        targets = [(price * 1.02).toFixed(4)];
        riskReward = '1:1';
    }
    
    return {
        symbol: symbolData.symbol,
        price: price.toFixed(4),
        signal: signal,
        confidence: confidence,
        targets: targets,
        stopLoss: stopLoss,
        riskReward: riskReward,
        rsi: rsi,
        divergence: symbolData.divergence,
        volume: symbolData.volume,
        analyzedByAI: true,
        aiTimestamp: new Date().getTime(),
        reasons: generateAIReasons(signal, rsi, symbolData.divergence)
    };
}

// ==================== ØªÙˆÙ„ÛŒØ¯ Ø¯Ù„Ø§ÛŒÙ„ AI ====================
function generateAIReasons(signal, rsi, divergence) {
    const reasons = [];
    
    if (rsi < 30) reasons.push('RSI Ø¯Ø± Ù†Ø§Ø­ÛŒÙ‡ Ø§Ø´Ø¨Ø§Ø¹ ÙØ±ÙˆØ´');
    if (rsi > 70) reasons.push('RSI Ø¯Ø± Ù†Ø§Ø­ÛŒÙ‡ Ø§Ø´Ø¨Ø§Ø¹ Ø®Ø±ÛŒØ¯');
    if (divergence) reasons.push(divergence.description);
    if (rsi > 40 && rsi < 60) reasons.push('RSI Ø¯Ø± Ù†Ø§Ø­ÛŒÙ‡ Ø®Ù†Ø«ÛŒ');
    
    if (signal === 'BUY') {
        reasons.push('Ù¾ØªØ§Ù†Ø³ÛŒÙ„ ØµØ¹ÙˆØ¯ÛŒ Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ø´Ø¯');
        reasons.push('ÙˆØ§Ú¯Ø±Ø§ÛŒÛŒ Ù…Ø«Ø¨Øª ØªØ´Ø®ÛŒØµ Ø¯Ø§Ø¯Ù‡ Ø´Ø¯');
    } else if (signal === 'SELL') {
        reasons.push('Ù¾ØªØ§Ù†Ø³ÛŒÙ„ Ù†Ø²ÙˆÙ„ÛŒ Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ø´Ø¯');
        reasons.push('ÙˆØ§Ú¯Ø±Ø§ÛŒÛŒ Ù…Ù†ÙÛŒ ØªØ´Ø®ÛŒØµ Ø¯Ø§Ø¯Ù‡ Ø´Ø¯');
    } else {
        reasons.push('ÙˆØ¶Ø¹ÛŒØª Ù†Ø§Ù…Ø´Ø®Øµ - Ù†ÛŒØ§Ø² Ø¨Ù‡ Ù†Ø¸Ø§Ø±Øª Ø¨ÛŒØ´ØªØ±');
    }
    
    return reasons.slice(0, 3);
}

// ==================== Ù†Ù…Ø§ÛŒØ´ Ø³ÛŒÚ¯Ù†Ø§Ù„â€ŒÙ‡Ø§ÛŒ AI ====================
function displayAISignals() {
    if (topAISignals.length === 0) return;
    
    let aiHtml = `
        <div style="margin-top: 15px;">
            <h4 style="margin: 0 0 10px 0; color: var(--accent);">
                ğŸ§  Ø³ÛŒÚ¯Ù†Ø§Ù„â€ŒÙ‡Ø§ÛŒ ØªØ­Ù„ÛŒÙ„ AI (${topAISignals.length} Ø§Ø±Ø² Ø¨Ø±ØªØ±)
            </h4>
    `;
    
    topAISignals.forEach((signal, index) => {
        const signalClass = signal.signal === 'BUY' ? 'ai-signal-buy' : 
                          signal.signal === 'SELL' ? 'ai-signal-sell' : 'ai-signal-hold';
        
        const confidenceColor = signal.confidence > 0.8 ? 'var(--success)' : 
                               signal.confidence > 0.6 ? 'var(--warning)' : 'var(--danger)';
        
        aiHtml += `
            <div class="ai-signal-card ${signalClass}">
                <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                    <div>
                        <div style="font-weight: bold; font-size: 14px; color: ${signal.signal === 'BUY' ? 'var(--success)' : signal.signal === 'SELL' ? 'var(--danger)' : '#aaa'};">
                            ${index + 1}. ${signal.symbol} - ${signal.signal === 'BUY' ? 'ğŸŸ¢ Ø®Ø±ÛŒØ¯' : signal.signal === 'SELL' ? 'ğŸ”´ ÙØ±ÙˆØ´' : 'âšª Ù†Ú¯Ù‡Ø¯Ø§Ø±ÛŒ'}
                        </div>
                        <div style="font-size: 12px; color: #aaa; margin-top: 2px;">
                            Ù‚ÛŒÙ…Øª: $${signal.price} | RSI: ${signal.rsi?.toFixed(1) || '--'}
                        </div>
                    </div>
                    <div style="text-align: right;">
                        <div style="font-size: 12px; color: ${confidenceColor};">
                            Ø§Ø·Ù…ÛŒÙ†Ø§Ù†: ${(signal.confidence * 100).toFixed(0)}%
                        </div>
                        <div style="font-size: 11px; color: #666;">
                            ${new Date(signal.aiTimestamp).toLocaleTimeString('fa-IR')}
                        </div>
                    </div>
                </div>
                
                <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid rgba(255,255,255,0.1);">
                    <div style="font-size: 12px; color: #aaa; margin-bottom: 5px;">
                        <strong>Ø§Ù‡Ø¯Ø§Ù:</strong>
                        ${signal.targets ? signal.targets.map((t, i) => 
                            `<span class="target-badge">T${i+1}: $${t}</span>`
                        ).join('') : '--'}
                    </div>
                    
                    <div style="font-size: 12px; color: #aaa; margin-bottom: 5px;">
                        <strong>Ø­Ø¯ Ø¶Ø±Ø±:</strong> $${signal.stopLoss || '--'}
                        <span style="margin-right: 10px;"></span>
                        <strong>Ø±ÛŒØ³Ú©/Ø³ÙˆØ¯:</strong> ${signal.riskReward || '--'}
                    </div>
                    
                    ${signal.reasons && signal.reasons.length > 0 ? `
                    <div style="font-size: 11px; color: #666; margin-top: 8px;">
                        <strong>Ø¯Ù„Ø§ÛŒÙ„:</strong> ${signal.reasons.join(' â€¢ ')}
                    </div>
                    ` : ''}
                </div>
            </div>
        `;
    });
    
    aiHtml += `</div>`;
    document.getElementById('aiContent').innerHTML = aiHtml;
}

// ==================== ØªÙˆØ§Ø¨Ø¹ Ú©Ù…Ú©ÛŒ ====================
function getStatusHtml(data) {
    switch(data.status) {
        case 'strong_buy':
            return '<span style="color: var(--success); font-weight: bold;">ğŸ“ˆ Ø®Ø±ÛŒØ¯ Ù‚ÙˆÛŒ</span>';
        case 'buy':
            return '<span style="color: var(--success);">ğŸ“¢ Ø®Ø±ÛŒØ¯</span>';
        case 'strong_sell':
            return '<span style="color: var(--danger); font-weight: bold;">ğŸ“‰ ÙØ±ÙˆØ´ Ù‚ÙˆÛŒ</span>';
        case 'sell':
            return '<span style="color: var(--danger);">ğŸ”´ ÙØ±ÙˆØ´</span>';
        case 'neutral':
            return '<span style="color: #aaa;">âšª Ø®Ù†Ø«ÛŒ</span>';
        default:
            return '<span style="color: #666;">ğŸ‘ï¸ Ù†Ø¸Ø§Ø±Øª</span>';
    }
}

function formatVolume(volume) {
    if (volume >= 1000000) return (volume / 1000000).toFixed(1) + 'M';
    if (volume >= 1000) return (volume / 1000).toFixed(1) + 'K';
    return volume.toFixed(0);
}

function sleep(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
}

function simulateLocalAnalysis(symbolData) {
    const rsi = 25 + Math.random() * 50;
    const change24h = (Math.random() - 0.5) * 15;
    const hasDivergence = Math.random() > 0.7;
    
    return {
        symbol: symbolData.symbol,
        price: (Math.random() * 50000).toFixed(4),
        change24h: change24h,
        volume: formatVolume(Math.random() * 10000000),
        rsi: rsi,
        divergence: hasDivergence ? {
            type: rsi < 35 ? 'bullish' : 'bearish',
            strength: 'medium',
            description: 'ÙˆØ§Ú¯Ø±Ø§ÛŒÛŒ ØªØ´Ø®ÛŒØµ Ø¯Ø§Ø¯Ù‡ Ø´Ø¯'
        } : null,
        preliminaryScore: (Math.random() - 0.5) * 100,
        status: determineStatus(rsi, hasDivergence ? {type: rsi < 35 ? 'bullish' : 'bearish'} : null}),
        isTopCandidate: false,
        timestamp: new Date().getTime()
    };
}

// ==================== ØªØ­Ù„ÛŒÙ„ Ø¯Ø³ØªÛŒ ====================
async function requestAnalysis() {
    const symbol = document.getElementById('symbolInput').value.toUpperCase().trim();
    if (!symbol) {
        showNotification("Ù„Ø·ÙØ§Ù‹ Ù†Ù…Ø§Ø¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯", "error");
        return;
    }
    
    document.getElementById('aiContent').innerHTML = `<span style="color: var(--primary);">ğŸ” ØªØ­Ù„ÛŒÙ„ ${symbol}...</span>`;
    
    try {
        // ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ API Ù¾Ø§ÛŒØªÙˆÙ† Ø¨Ø±Ø§ÛŒ ØªØ­Ù„ÛŒÙ„ Ø¹Ù…ÛŒÙ‚
        const response = await fetch(`${PYTHON_API_URL}?symbol=${symbol}`);
        
        if (!response.ok) {
            throw new Error(`HTTP Error: ${response.status}`);
        }

        const pythonAnalysis = await response.json();
        
        // Ù†Ù…Ø§ÛŒØ´ Ù†ØªØ§ÛŒØ¬ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ Ù¾Ø§ÛŒØªÙˆÙ†
        displayPythonAnalysis(pythonAnalysis);
        showNotification(`ØªØ­Ù„ÛŒÙ„ ${symbol} Ú©Ø§Ù…Ù„ Ø´Ø¯`, "success");
        
    } catch (error) {
        document.getElementById('aiContent').innerHTML = `
            <span style="color: var(--danger);">âŒ Ø®Ø·Ø§ Ø¯Ø± ØªØ­Ù„ÛŒÙ„ ${symbol}</span><br>
            <span style="color: #aaa; font-size: 13px;">${error.message}</span>
        `;
        showNotification("Ø®Ø·Ø§ Ø¯Ø± ØªØ­Ù„ÛŒÙ„", "error");
    }
}

// ==================== ØªØ­Ù„ÛŒÙ„ Ù…Ø­Ù„ÛŒ (Ø¨Ø±Ø§ÛŒ ØªØ­Ù„ÛŒÙ„ Ø¯Ø³ØªÛŒ) ====================
function performLocalAnalysis(tickerData, klines, symbolData) {
    // Ù…Ø­Ø§Ø³Ø¨Ù‡ RSI
    const rsi14 = calculateRSIFromKlines(klines, 14);
    const rsi7 = calculateRSIFromKlines(klines.slice(-30), 7);
    
    // ØªØ´Ø®ÛŒØµ ÙˆØ§Ú¯Ø±Ø§ÛŒÛŒ
    const divergence = detectDivergenceLocal(klines, rsi14);
    
    // Ù…Ø­Ø§Ø³Ø¨Ù‡ Stochastic
    const stochastic = calculateStochasticLocal(klines);
    
    // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø§Ù…ØªÛŒØ§Ø² Ø§ÙˆÙ„ÛŒÙ‡
    const preliminaryScore = calculatePreliminaryScore({
        rsi14: rsi14,
        rsi7: rsi7,
        stochastic: stochastic,
        divergence: divergence,
        priceChange: parseFloat(tickerData.priceChangePercent),
        volume: parseFloat(tickerData.volume),
        price: parseFloat(tickerData.lastPrice)
    });
    
    // ØªØ¹ÛŒÛŒÙ† ÙˆØ¶Ø¹ÛŒØª
    const status = determineLocalStatus(rsi14, divergence, stochastic);
    
    return {
        symbol: symbolData.symbol,
        price: parseFloat(tickerData.lastPrice).toFixed(4),
        change24h: parseFloat(tickerData.priceChangePercent),
        volume: formatVolume(parseFloat(tickerData.volume)),
        rsi: rsi14,
        rsi7: rsi7,
        stochastic: stochastic,
        divergence: divergence,
        preliminaryScore: preliminaryScore,
        status: status,
        isTopCandidate: false,
        timestamp: new Date().getTime()
    };
}

// ==================== Ù…Ø­Ø§Ø³Ø¨Ù‡ RSI ====================
function calculateRSIFromKlines(klines, period = 14) {
    if (klines.length < period + 1) return 50;
    
    const closes = klines.map(k => parseFloat(k[4]));
    let gains = 0;
    let losses = 0;
    
    for (let i = 1; i <= period; i++) {
        const change = closes[i] - closes[i - 1];
        if (change > 0) {
            gains += change;
        } else {
            losses += Math.abs(change);
        }
    }
    
    if (losses === 0) return 100;
    
    const avgGain = gains / period;
    const avgLoss = losses / period;
    const rs = avgGain / avgLoss;
    const rsi = 100 - (100 / (1 + rs));
    
    return Math.min(Math.max(rsi, 0), 100);
}

// ==================== ØªØ´Ø®ÛŒØµ ÙˆØ§Ú¯Ø±Ø§ÛŒÛŒ Ù…Ø­Ù„ÛŒ ====================
function detectDivergenceLocal(klines, rsi) {
    if (klines.length < 20) return null;
    
    const closes = klines.map(k => parseFloat(k[4]));
    const lastClose = closes[closes.length - 1];
    const prevClose = closes[closes.length - 2];
    
    if (rsi < 30 && lastClose > prevClose) {
        return {
            type: 'bullish',
            strength: 'medium',
            description: 'ÙˆØ§Ú¯Ø±Ø§ÛŒÛŒ Ù…Ø«Ø¨Øª Ø¯Ø± Ø§Ø´Ø¨Ø§Ø¹ ÙØ±ÙˆØ´'
        };
    } else if (rsi > 70 && lastClose < prevClose) {
        return {
            type: 'bearish',
            strength: 'medium',
            description: 'ÙˆØ§Ú¯Ø±Ø§ÛŒÛŒ Ù…Ù†ÙÛŒ Ø¯Ø± Ø§Ø´Ø¨Ø§Ø¹ Ø®Ø±ÛŒØ¯'
        };
    }
    
    return null;
}

// ==================== Ù…Ø­Ø§Ø³Ø¨Ù‡ Stochastic Ù…Ø­Ù„ÛŒ ====================
function calculateStochasticLocal(klines, period = 14) {
    if (klines.length < period) return { k: 50, d: 50, isOversold: false, isOverbought: false };
    
    const closes = klines.map(k => parseFloat(k[4]));
    const highs = klines.map(k => parseFloat(k[2]));
    const lows = klines.map(k => parseFloat(k[3]));
    
    const currentClose = closes[closes.length - 1];
    const periodHigh = Math.max(...highs.slice(-period));
    const periodLow = Math.min(...lows.slice(-period));
    
    if (periodHigh === periodLow) return { k: 50, d: 50, isOversold: false, isOverbought: false };
    
    const k = ((currentClose - periodLow) / (periodHigh - periodLow)) * 100;
    const d = k; // Ø¨Ø±Ø§ÛŒ Ø³Ø§Ø¯Ú¯ÛŒ
    
    return {
        k: k,
        d: d,
        isOversold: k < 20,
        isOverbought: k > 80
    };
}

// ==================== Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø§Ù…ØªÛŒØ§Ø² Ø§ÙˆÙ„ÛŒÙ‡ ====================
function calculatePreliminaryScore(data) {
    let score = 0;
    
    // Ø§Ù…ØªÛŒØ§Ø² RSI
    if (data.rsi14 < 30) score += 25;
    else if (data.rsi14 > 70) score -= 25;
    else if (data.rsi14 > 40 && data.rsi14 < 60) score += 5;
    
    // Ø§Ù…ØªÛŒØ§Ø² Stochastic
    if (data.stochastic.isOversold) score += 15;
    else if (data.stochastic.isOverbought) score -= 15;
    
    // Ø§Ù…ØªÛŒØ§Ø² ÙˆØ§Ú¯Ø±Ø§ÛŒÛŒ
    if (data.divergence) {
        if (data.divergence.type === 'bullish') score += 30;
        else if (data.divergence.type === 'bearish') score -= 30;
    }
    
    // Ø§Ù…ØªÛŒØ§Ø² Ø­Ø¬Ù… (Ø§Ú¯Ø± Ø­Ø¬Ù… Ø¨Ø§Ù„Ø§ Ø¨Ø§Ø´Ø¯)
    if (data.volume > 1000000) score += 10;
    
    // Ø§Ù…ØªÛŒØ§Ø² ØªØºÛŒÛŒØ± Ù‚ÛŒÙ…Øª
    if (data.priceChange > 5) score += 10;
    else if (data.priceChange < -5) score -= 10;
    
    return Math.max(Math.min(score, 100), -100);
}

// ==================== ØªØ¹ÛŒÛŒÙ† ÙˆØ¶Ø¹ÛŒØª Ù…Ø­Ù„ÛŒ ====================
function determineLocalStatus(rsi, divergence, stochastic) {
    if (rsi < 30 && divergence && divergence.type === 'bullish') {
        return 'strong_buy';
    } else if (rsi > 70 && divergence && divergence.type === 'bearish') {
        return 'strong_sell';
    } else if (rsi < 30 || stochastic.isOversold) {
        return 'buy';
    } else if (rsi > 70 || stochastic.isOverbought) {
        return 'sell';
    } else if (rsi > 40 && rsi < 60) {
        return 'neutral';
    } else {
        return 'watch';
    }
}

// ==================== Ù†Ù…Ø§ÛŒØ´ ØªØ­Ù„ÛŒÙ„ Ø¯Ø³ØªÛŒ ====================
function displayManualAnalysis(analysis) {
    const signalClass = analysis.signal === 'BUY' ? 'ai-signal-buy' : 
                       analysis.signal === 'SELL' ? 'ai-signal-sell' : 'ai-signal-hold';
    
    document.getElementById('aiContent').innerHTML = `
        <div class="ai-signal-card ${signalClass}">
            <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                <div>
                    <div style="font-weight: bold; font-size: 16px; color: ${analysis.signal === 'BUY' ? 'var(--success)' : analysis.signal === 'SELL' ? 'var(--danger)' : '#aaa'};">
                        ${analysis.symbol} - ${analysis.signal === 'BUY' ? 'ğŸŸ¢ Ø³ÛŒÚ¯Ù†Ø§Ù„ Ø®Ø±ÛŒØ¯' : analysis.signal === 'SELL' ? 'ğŸ”´ Ø³ÛŒÚ¯Ù†Ø§Ù„ ÙØ±ÙˆØ´' : 'âšª Ù†Ú¯Ù‡Ø¯Ø§Ø±ÛŒ'}
                    </div>
                    <div style="font-size: 14px; color: #aaa; margin-top: 5px;">
                        Ù‚ÛŒÙ…Øª: $${analysis.price} | ØªØºÛŒÛŒØ± 24h: ${analysis.change24h >= 0 ? '+' : ''}${analysis.change24h?.toFixed(2) || '--'}%
                    </div>
                </div>
                <div style="text-align: right;">
                    <div style="font-size: 14px; color: ${analysis.confidence > 0.8 ? 'var(--success)' : analysis.confidence > 0.6 ? 'var(--warning)' : 'var(--danger)'};">
                        Ø§Ø·Ù…ÛŒÙ†Ø§Ù†: ${(analysis.confidence * 100).toFixed(0)}%
                    </div>
                    <div style="font-size: 12px; color: #666; margin-top: 5px;">
                        RSI: ${analysis.rsi?.toFixed(1) || '--'}
                    </div>
                </div>
            </div>
            
            <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.1);">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px;">
                    <div>
                        <div style="font-size: 12px; color: #aaa; margin-bottom: 3px;">Ø­Ø¯ Ø¶Ø±Ø±:</div>
                        <div style="font-size: 14px; color: var(--danger); font-weight: bold;">
                            $${analysis.stopLoss || '--'}
                        </div>
                    </div>
                    <div>
                        <div style="font-size: 12px; color: #aaa; margin-bottom: 3px;">Ø±ÛŒØ³Ú©/Ø³ÙˆØ¯:</div>
                        <div style="font-size: 14px; color: var(--warning); font-weight: bold;">
                            ${analysis.riskReward || '--'}
                        </div>
                    </div>
                </div>
                
                <div style="font-size: 12px; color: #aaa; margin-bottom: 5px;">Ø§Ù‡Ø¯Ø§Ù Ù‚ÛŒÙ…ØªÛŒ:</div>
                <div style="display: flex; gap: 5px; flex-wrap: wrap;">
                    ${analysis.targets ? analysis.targets.map((t, i) => `
                        <div class="target-badge" style="background: rgba(0, 217, 255, 0.2); color: var(--primary);">
                            T${i+1}: $${t}
                        </div>
                    `).join('') : '--'}
                </div>
                
                ${analysis.reasons && analysis.reasons.length > 0 ? `
                <div style="margin-top: 15px; padding-top: 10px; border-top: 1px solid rgba(255,255,255,0.1);">
                    <div style="font-size: 12px; color: #aaa; margin-bottom: 5px;">ØªØ­Ù„ÛŒÙ„ ØªÚ©Ù†ÛŒÚ©Ø§Ù„:</div>
                    <div style="font-size: 11px; color: #666;">
                        ${analysis.reasons.join(' â€¢ ')}
                    </div>
                </div>
                ` : ''}
            </div>
        </div>
    `;
}

// ==================== ØªÙˆØ§Ø¨Ø¹ Ù…Ø¯ÛŒØ±ÛŒØª ====================
function showNotification(message, type = 'info') {
    const notif = document.getElementById('notification');
    notif.className = `notification notification-${type}`;
    notif.innerHTML = message;
    notif.style.display = 'block';
    setTimeout(() => notif.style.display = 'none', 3000);
}

function toggleMode(mode) {
    activeMode = mode;
    showNotification(`Ø­Ø§Ù„Øª ${mode === 'scalp' ? 'Ø§Ø³Ú©Ø§Ù„Ù¾ 5 Ø¯Ù‚ÛŒÙ‚Ù‡' : 'Ø±ÙˆÙ†Ø¯ 1 Ø³Ø§Ø¹ØªÙ‡'} ÙØ¹Ø§Ù„ Ø´Ø¯`, "info");
}

function stopAllAnalysis() {
    if (isCryptoScanning) stopCryptoScan();
    showNotification("Ù‡Ù…Ù‡ ØªØ­Ù„ÛŒÙ„â€ŒÙ‡Ø§ Ù…ØªÙˆÙ‚Ù Ø´Ø¯Ù†Ø¯", "info");
}

async function updateAdminDashboard() {
    // ÙØ¹Ù„Ø§ Ø®Ø§Ù„ÛŒ
}

</script>
</body>
</html>